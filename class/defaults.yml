parameters:
  vcluster:
    =_metadata:
      multi_instance: true
      multi_tenant: true
    namespace: syn-${_instance}
    namespaceMetadata: {}

    charts:
      vcluster:
        source: https://charts.loft.sh
        version: 0.29.1

    images:
      k8s:
        registry: ghcr.io
        image: loft-sh/kubernetes
        tag: v1.34.1
      syncer:
        registry: ghcr.io
        image: loft-sh/vcluster-oss
        tag: "0.29.1"
      oc:
        registry: quay.io
        image: appuio/oc
        tag: v4.19

    storage:
      persistence: auto
      size: 5Gi
      class_name: null

    k8s:
      additional_apiserver_args: []
      additional_controllermanager_args: []
      additional_scheduler_args: []

    ingress:
      enabled: true
      host: null
      annotations:
        cert-manager.io/cluster-issuer: letsencrypt-production

    backing_store: {}

    additional_manifests: ""

    resources:
      k8s:
        requests:
          cpu: 40m
          memory: 64Mi
        limits:
          cpu: 100m
          memory: 256Mi
      syncer:
        requests:
          cpu: 200m
          memory: 256Mi
        limits:
          memory: 2Gi

    helm_values:
      sync:
        toHost:
          ingresses:
            enabled: true
      controlPlane:
        distro:
          k3s:
            enabled: false
          k8s:
            enabled: true
            apiServer:
              extraArgs: ${vcluster:k8s:additional_apiserver_args}
            controllerManager:
              extraArgs: ${vcluster:k8s:additional_controllermanager_args}
            scheduler:
              extraArgs: ${vcluster:k8s:additional_scheduler_args}
            image:
              registry: ${vcluster:images:k8s:registry}
              repository: ${vcluster:images:k8s:image}
              tag: ${vcluster:images:k8s:tag}
            resources: ${vcluster:resources:k8s}

        statefulSet:
          security:
            containerSecurityContext:
              allowPrivilegeEscalation: false
              runAsUser: null
              runAsGroup: null
          resources: ${vcluster:resources:syncer}
          image:
            registry: ${vcluster:images:syncer:registry}
            repository: ${vcluster:images:syncer:image}
            tag: ${vcluster:images:syncer:tag}
          persistence:
            volumeClaim:
              enabled: ${vcluster:storage:persistence}
              size: ${vcluster:storage:size}
              storageClass: ${vcluster:storage:class_name}
        backingStore: ${vcluster:backing_store}
        ingress:
          enabled: ${vcluster:ingress:enabled}
          host: ${vcluster:ingress:host}
          annotations: ${vcluster:ingress:annotations}
          spec:
            tls:
              - hosts:
                  - ${vcluster:ingress:host}
                secretName: ${_instance}-tls
      rbac:
        role:
          extraRules:
            - apiGroups: [""]
              resources: ["endpoints/restricted"]
              verbs: ["create"]
      exportKubeConfig:
        server: https://${vcluster:ingress:host}
        serviceAccount:
          name: ${_instance}-admin
          clusterRole: cluster-admin
      experimental:
        deploy:
          vcluster:
            manifests: ${vcluster:additional_manifests}
    syn:
      registration_url: null
